---
layout: post
title: "Swift中文转换拼音及中文数组排序"
tags: [Swift]
categories: [Tech]
cover: "upload/blog_masonry_05.jpg"
---

* 判断字符串中是否有中文

{% highlight swift %}
/// 判断字符串中是否有中文
func isIncludeChinese() -> Bool {
    for ch in self.unicodeScalars {
        if (0x4e00 < ch.value  && ch.value < 0x9fff) { return true } // 中文字符范围：0x4e00 ~ 0x9fff
    }
    return false
}
{% endhighlight %}

* 将中文字符串转换为拼音

{% highlight swift %}
/// - Parameter hasBlank: 是否带空格（默认不带空格）
func transformToPinyin(hasBlank: Bool =false) -> String {

    let stringRef = NSMutableString(string: self) as CFMutableString
    CFStringTransform(stringRef,nil, kCFStringTransformToLatin, false) // 转换为带音标的拼音
    CFStringTransform(stringRef, nil, kCFStringTransformStripCombiningMarks, false) // 去掉音标
    let pinyin = stringRef as String
    return hasBlank ? pinyin : pinyin.replacingOccurrences(of: " ", with: "")
}
{% endhighlight %}

* 获取中文首字母

{% highlight swift %}
/// - Parameter lowercased: 是否小写（默认大写）
func transformToPinyinHead(lowercased: Bool =false) -> String {
    let pinyin = self.transformToPinyin(hasBlank: true).capitalized // 字符串转换为首字母大写
    var headPinyinStr = ""
    for ch in pinyin.characters {
        if ch <= "Z" && ch >= "A" {
            headPinyinStr.append(ch) // 获取所有大写字母
        }
    }
    return lowercased ? headPinyinStr.lowercased() : headPinyinStr
}
{% endhighlight %}

* 中文数组排序

只需要为 Array 类写一个扩展即可，必须为 Array<String> 类型才能排序。

{% highlight swift %}
extension Array {
    /// - Parameter ascending: 是否升序（默认升序）
    func sortedByPinyin(ascending: Bool = true) -> Array<String>? {
        if self is Array<String> {
            return (self as! Array<String>).sorted { (value1, value2) -> Bool in
                let pinyin1 = value1.transformToPinyin()
                let pinyin2 = value2.transformToPinyin()
                return pinyin1.compare(pinyin2) == (ascending ? .orderedAscending : .orderedDescending)
            }
        }
        return nil
    }
}
{% endhighlight %}

* 中文首字母排序

<br>
在Objective C语言中，字符串是以unicode进行编码的。在unicode字符集中，汉字的编码范围为4E00 到 9FA5 之间（即从第19968开始的20902个字符是中文简体字符）。我们把这些字符的拼音首字母按照顺序都存放在一个char数组中。当我们查找一个汉字的拼音首字母时，只需把这个汉字的unicode码（即char强制转换为int）减去19968，然后用这个数字作为索引去找char数组中存放的字母即可。
<br>
至于排序，我们可以把要排序的中文（为简便起见，我们假设这些要排序的中文都只有一个字）放到NSArray中，然后利用NSArray的sortedArrayUsingComparator:方法进行排序即可。sortedArrayUsingComparator:方法是NSArray内部元素的比较方法。你只需要为这个方法提供一个块作为参数即可。然后在这个块中，对两个元素的大小进行比较，并返回一个NSComparisonResult（NSComparisonResult枚举用于表示比较的结果：等于、小于、大于）：
<br>

{% highlight swift %}
char pinyinFirstLetter(unsigned short hanzi)
{
    int index = hanzi - HANZI_START;
    if (index >= 0 && index <= HANZI_COUNT)
    {
        return firstLetterArray[index];
    }
    else
    {
        return hanzi;
    }
}
{% endhighlight %}

{% highlight swift %}
NSArray *sortedArray=[mArray sortedArrayUsingComparator:^(id a, id b) {

    char c1=pinyinFirstLetter([(NSString*)a characterAtIndex:0]);
    char c2=pinyinFirstLetter([(NSString*)b characterAtIndex:0]);
    NSString* s1=[[NSStringstringWithFormat:@"%c",c1] uppercaseString];
    NSString* s2=[[NSStringstringWithFormat:@"%c",c2] uppercaseString];
    return [s1 compare:s2];

}];
{% endhighlight %}


[[Ref.] Swift中文转换拼音及中文数组排序详解](http://www.qingpingshan.com/rjbc/swift/326994.html)

[[Ref.] 中文首字母排序](https://blog.csdn.net/kmyhy/article/details/7419208)

[[Ref.] 拼音首字母数组Git](https://github.com/jimneylee/JLNameSectionSort/blob/master/3rdParty/Pinyin/pinyin.c)


