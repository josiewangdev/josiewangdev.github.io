---
layout: post
title: 剪裁图片 · Crop image
tags: iOS
categories: Dev
---

Disable editing for the image picker and handle it yourself. 

Put the image in a scrollable, zoomable image view. 

On top of the image view is a fixed position "crop guide view" that draws the crop indicator the user sees. 

Assuming the guide view has properties for the visible rect (the part to keep) and edge widths (the part to discard) you can get the cropping rectangle like so. 

You can use the `UIImage+Resize` category to do the actual cropping.

自定义剪裁图片视图而非使用系统自带的编辑视图。

将图片放在一个可滚动和缩放的 image view 中。

在 image view 上是一个固定位置的 “剪裁示意框”。

通过示意框的可见区域参数（保留的部分）和边界宽度（剪裁的部分）可以得到图片对应的剪裁区域。

再使用扩展类 `UIImage+Resize` 可进行剪裁。

---

{% highlight swift %}
CGRect cropGuide = self.cropGuideView.visibleRect;
UIEdgeInsets edges = self.cropGuideView.edgeWidths;
CGPoint cropGuideOffset = self.cropScrollView.contentOffset;

CGPoint origin = CGPointMake( cropGuideOffset.x + edges.left, cropGuideOffset.y + edges.top );
CGSize size = cropGuide.size;
CGRect crop = { origin, size };

crop.origin.x = crop.origin.x / self.cropScrollView.zoomScale;
crop.origin.y = crop.origin.y / self.cropScrollView.zoomScale;
crop.size.width = crop.size.width / self.cropScrollView.zoomScale;
crop.size.height = crop.size.height / self.cropScrollView.zoomScale;

photo = [photo croppedImage:crop];
{% endhighlight %}

[[Ref.参考] Git - UIImage Categories](https://github.com/mbcharbonneau/UIImage-Categories)



